{
	"name": "Create DWH schema",
	"properties": {
		"folder": {
			"name": "Challenge 05/original"
		},
		"content": {
			"query": "/* Connect to the SQL POOL and Execute */\n\nCREATE TABLE [dbo].[DimActors] (\n    [ActorSK]     INT              NOT NULL,\n    [ActorID]     UNIQUEIDENTIFIER NOT NULL,\n    [ActorName]   VARCHAR (81)     NOT NULL,\n    [ActorGender] CHAR (1)         NOT NULL\n)\nWITH (HEAP, DISTRIBUTION = REPLICATE);\n\nCREATE TABLE [dbo].[DimCategories] (\n    [MovieCategorySK]          TINYINT      NOT NULL,\n    [MovieCategoryDescription] VARCHAR (50) NOT NULL\n)\nWITH (HEAP, DISTRIBUTION = REPLICATE);\n\nCREATE TABLE [dbo].[DimCustomers] (\n    [CustomerSK]      INT              NOT NULL,\n    [CustomerID]      UNIQUEIDENTIFIER NOT NULL,\n    [LastName]        VARCHAR (50)     NOT NULL,\n    [FirstName]       VARCHAR (30)     NOT NULL,\n    [AddressLine1]    VARCHAR (50)     NOT NULL,\n    [AddressLine2]    VARCHAR (50)     NULL,\n    [City]            VARCHAR (30)     NOT NULL,\n    [State]           CHAR (2)         NOT NULL,\n    [ZipCode]         CHAR (5)         NOT NULL,\n    [PhoneNumber]     CHAR (10)        NOT NULL,\n    [RecordStartDate] DATE             NOT NULL,\n    [RecordEndDate]   DATE             NULL,\n    [ActiveFlag]      BIT              NOT NULL\n)\nWITH (CLUSTERED COLUMNSTORE INDEX, DISTRIBUTION = HASH([CustomerSK]));\n\nCREATE TABLE [dbo].[DimDate] (\n    [DateSK]         INT      NOT NULL,\n    [DateValue]      DATE     NOT NULL,\n    [DateYear]       SMALLINT NOT NULL,\n    [DateMonth]      TINYINT  NOT NULL,\n    [DateDay]        TINYINT  NOT NULL,\n    [DateDayOfWeek]  TINYINT  NOT NULL,\n    [DateDayOfYear]  SMALLINT NOT NULL,\n    [DateWeekOfYear] TINYINT  NOT NULL\n)\nWITH (HEAP, DISTRIBUTION = REPLICATE);\n\nCREATE TABLE [dbo].[DimLocation] (\n    [LocationSK]   SMALLINT     NOT NULL,\n    [LocationName] VARCHAR (50) NOT NULL,\n    [Streaming]    BIT          NOT NULL,\n    [Rentals]      BIT          NOT NULL,\n    [Sales]        BIT          NOT NULL\n)\nWITH (HEAP, DISTRIBUTION = REPLICATE);\n\nCREATE TABLE [dbo].[DimMovieActors] (\n    [MovieID] UNIQUEIDENTIFIER NOT NULL,\n    [ActorID] UNIQUEIDENTIFIER NOT NULL\n)\nWITH (HEAP, DISTRIBUTION = REPLICATE);\n\nCREATE TABLE [dbo].[DimMovies] (\n    [MovieSK]         INT              NOT NULL,\n    [MovieID]         UNIQUEIDENTIFIER NOT NULL,\n    [MovieTitle]      VARCHAR (100)    NOT NULL,\n    [MovieCategorySK] TINYINT          NOT NULL,\n    [MovieRatingSK]   TINYINT          NOT NULL,\n    [MovieRunTimeMin] SMALLINT         NOT NULL\n)\nWITH (HEAP, DISTRIBUTION = REPLICATE);\n\nCREATE TABLE [dbo].[DimRatings] (\n    [MovieRatingSK]          TINYINT     NOT NULL,\n    [MovieRatingDescription] VARCHAR (5) NOT NULL\n)\nWITH (HEAP, DISTRIBUTION = REPLICATE);\n\nCREATE TABLE [dbo].[DimTime] (\n    [TimeSK]          INT      NOT NULL,\n    [TimeValue]       TIME (7) NOT NULL,\n    [TimeHour]        TINYINT  NOT NULL,\n    [TimeMinute]      TINYINT  NOT NULL,\n    [TimeSecond]      TINYINT  NOT NULL,\n    [TimeMinuteOfDay] SMALLINT NOT NULL,\n    [TimeSecondOfDay] INT      NOT NULL\n)\nWITH (HEAP, DISTRIBUTION = REPLICATE);\n\nCREATE TABLE [dbo].[FactRentals] (\n    [RentalSK]       INT              NOT NULL,\n    [TransactionID]  UNIQUEIDENTIFIER NOT NULL,\n    [CustomerSK]     INT              NOT NULL,\n    [LocationSK]     SMALLINT         NOT NULL,\n    [MovieSK]        INT              NOT NULL,\n    [RentalDateSK]   INT              NOT NULL,\n    [ReturnDateSK]   INT              NULL,\n    [RentalDuration] TINYINT          NULL,\n    [RentalCost]     MONEY            NOT NULL,\n    [LateFee]        MONEY            NULL,\n    [TotalCost]      MONEY            NULL,\n    [RewindFlag]     BIT              NULL\n)\nWITH (CLUSTERED COLUMNSTORE INDEX, DISTRIBUTION = HASH([CustomerSK]));\n\nCREATE TABLE [dbo].[FactSales] (\n    [SalesSK]      INT              NOT NULL,\n    [OrderID]      UNIQUEIDENTIFIER NOT NULL,\n    [LineNumber]   TINYINT          NOT NULL,\n    [OrderDateSK]  INT              NOT NULL,\n    [ShipDateSK]   INT              NULL,\n    [CustomerSK]   INT              NOT NULL,\n    [LocationSK]   SMALLINT         NOT NULL,\n    [MovieSK]      INT              NOT NULL,\n    [DaysToShip]   TINYINT          NULL,\n    [Quantity]     TINYINT          NOT NULL,\n    [UnitCost]     MONEY            NOT NULL,\n    [ExtendedCost] MONEY            NOT NULL\n)\nWITH (CLUSTERED COLUMNSTORE INDEX, DISTRIBUTION = HASH([CustomerSK]));\n\nCREATE TABLE [dbo].[FactStreaming] (\n    [StreamingSK]       INT              NOT NULL,\n    [TransactionID]     UNIQUEIDENTIFIER NOT NULL,\n    [CustomerSK]        INT              NOT NULL,\n    [MovieSK]           INT              NOT NULL,\n    [StreamStartDateSK] INT              NOT NULL,\n    [StreamStartTimeSK] INT              NOT NULL,\n    [StreamEndDateSK]   INT              NULL,\n    [StreamEndTimeSK]   INT              NULL,\n    [StreamDurationSec] INT              NULL,\n    [StreamDurationMin] DECIMAL (10, 4)  NULL\n)\nWITH (CLUSTERED COLUMNSTORE INDEX, DISTRIBUTION = HASH([CustomerSK]));\n\nCREATE TABLE [dbo].[Numbers] (\n    [Number] INT NOT NULL\n)\nWITH (CLUSTERED COLUMNSTORE INDEX, DISTRIBUTION = REPLICATE);\n\n\n-- Declare local variables...\nDECLARE\n\t@MaxNumber integer = 1;\n\n-- Insert the seed number...\nINSERT INTO dbo.Numbers\n(Number)\nVALUES\n(1);\n\n-- Loop through and insert additional data up to 1,048,576...\nWHILE (@MaxNumber < 1000000)\nBEGIN\n\tINSERT INTO dbo.Numbers\n\t(Number)\n\tSELECT Number + @MaxNumber\n\tFROM dbo.Numbers;\n\n\tSELECT @MaxNumber = MAX(Number)\n\tFROM dbo.Numbers;\nEND\n\nINSERT INTO dbo.DimDate\n(DateSK, DateValue, DateYear, DateMonth, DateDay, DateDayOfWeek, DateDayOfYear, DateWeekOfYear)\nSELECT \n\tNumber AS DateSK,\n\tDateValue, \n\tYEAR(DateValue) AS DateYear,\n\tMONTH(DateValue) AS DateMonth,\n\tDAY(DateValue) AS DateDay,\n\tDATEPART(WeekDay, DateValue) AS DateDayOfWeek,\n\tDATEPART(DayOfYear, DateValue) AS DateDayOfYear,\n\tDATEPART(Week, DateValue) AS DateWeekOfYear\nFROM\n(\n\tSELECT Number, DATEADD(d, Number - 1, '2017-01-01') AS DateValue\n\tFROM\n\t(\n\t\tSELECT Number\n\t\tFROM dbo.Numbers\n\t\tWHERE Number <= 365\n\t) AS N\n) AS D;\n\nINSERT INTO dbo.DimTime\n(TimeSK, TimeValue, TimeHour, TimeMinute, TimeSecond, TimeMinuteOfDay, TimeSecondOfDay)\nSELECT\n\tNumber AS TimeSK,\n\tTimeValue,\n\tDATEPART(HOUR, TimeValue) AS TimeHour,\n\tDATEPART(MINUTE, TimeValue) AS TimeMinute,\n\tDATEPART(SECOND, TimeValue) AS TimeSecond,\n\tDATEPART(MINUTE, TimeValue) + (DATEPART(HOUR, TimeValue) * 60) AS TimeMinuteOfDay,\n\tDATEPART(SECOND, TimeValue) + ((DATEPART(MINUTE, TimeValue) + (DATEPART(HOUR, TimeValue) * 60)) * 60) AS TimeSecondOfDay\nFROM\n(\n\tSELECT Number, CAST(DATEADD(s, Number - 1, '2017-01-01') as time(7)) AS TimeValue\n\tFROM dbo.Numbers\n\tWHERE Number <= 86400\n) AS T;\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "sqlpool",
				"poolName": "sqlpool"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}